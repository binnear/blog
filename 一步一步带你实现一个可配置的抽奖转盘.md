ä¹‹å‰åœ¨å…¬å¸é¡¹ç›®ä¸­å®ç°äº†ä¸€ä¸ªå¯é…ç½®çš„è½¬ç›˜æŠ½å¥–ï¼Œä¸»è¦æ˜¯ç”¨canvasè¿›è¡Œç»˜åˆ¶ï¼Œå†™è¿™ç¯‡æ–‡ç« æ˜¯ä¸ºäº†é€šè¿‡ä¸€ä¸ªå¤§å®¶å¯èƒ½ä¼šæ„Ÿå…´è¶£çš„ç‚¹ï¼Œæ¥ç†Ÿæ‚‰canvasçš„ä¸€äº›apiï¼Œæˆ‘è‡ªå·±ä¹Ÿç®—æ˜¯è¿›è¡Œä¸€äº›å¤ä¹ ã€‚ğŸ˜
  
è¿›å…¥æ­£é¢˜ï¼šé¦–å…ˆæˆ‘ä»¬åˆ†æä¸€ä¸‹éœ€æ±‚ï¼Œå®ç°ä¸€ä¸ªå¯é…ç½®çš„è½¬ç›˜æŠ½å¥–ï¼Œå¯ä»¥å…ˆåˆ†å‰²ä¸ºä¸¤ä¸ªéœ€æ±‚ï¼Œä¸€æ˜¯å®ç°ä¸€ä¸ªè½¬ç›˜æŠ½å¥–ï¼ŒäºŒæ˜¯è½¬ç›˜å¯é…ç½®ã€‚

## ä¸€ã€å®ç°ä¸€ä¸ªè½¬ç›˜æŠ½å¥–

åœ¨å®ç°ä¹‹å‰æˆ‘ä»¬è¦æœ‰ä¸€ä¸ªæ•´ä½“çš„æ€è·¯ï¼Œå›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ›¾ç»åœ¨ç½‘ä¸Šæˆ–è€…ç°å®ä¸­è§è¿‡çš„æŠ½å¥–è½¬ç›˜éƒ½æœ‰é‚£äº›å…ƒç´ ï¼š

* ä¸€ä¸ªå¤§çš„è½¬ç›˜
* è½¬ç›˜ä¸Šæœ‰ä¸€ä¸ªä¸ªåŒºé—´ï¼Œè¡¨ç¤ºä¸åŒçš„å¥–å“
* åœ¨è½¬ç›˜çš„ä¸­é—´æœ‰ä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰é’®ä¸Šæœ‰ä¸€ä¸ªæŒ‡é’ˆï¼Œæ¥æŒ‡å‘æŠ½ä¸­çš„å¥–å“

æˆ‘ä»¬å†æƒ³æƒ³æŠ½å¥–çš„è¿‡ç¨‹ï¼šå½“æˆ‘ä»¬ç‚¹å‡»ä¸­é—´çš„æŒ‰é’®ï¼Œè½¬ç›˜å¼€å§‹æ—‹è½¬ï¼Œå½“è·å–åˆ°å¥–å“åï¼Œæ—‹è½¬çš„é€Ÿåº¦ä»å¿«åˆ°æ…¢ï¼Œç¼“ç¼“åœä¸‹ï¼Œæœ€åæŒ‡å‘å¥–å“æ‰€åœ¨çš„é‚£ä¸ªåŒºåŸŸï¼Œæˆ‘ä»¬çš„å®ç°æ­¥éª¤å°±å¯ä»¥è¿™æ ·

- ç»˜åˆ¶æ‰€æœ‰çš„é™æ€å…ƒç´ 
- ç»™è½¬ç›˜æ·»åŠ æ—‹è½¬åŠ¨ç”»
- æŒ‡é’ˆæ‰€æŒ‡åŒºåŸŸä¸ºæˆ‘ä»¬æŒ‡å®šçš„å¥–å“

### 1.ç»˜åˆ¶æ‰€æœ‰é™æ€å…ƒç´ 

#### 1.1.å¼€å‘ç¯å¢ƒæ­å»º

å…¨å±€å®‰è£…`create-react-app`ï¼Œå¿«é€Ÿç”Ÿæˆ`react`çš„å¼€å‘ç¯å¢ƒï¼Œè¿™ä¸ªä¸æˆ‘ä»¬è¦å¼€å‘çš„è½¬ç›˜æ²¡æœ‰è€¦åˆå…³ç³»ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œç”¨`vue`ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

```javascript
// å…¨å±€å®‰è£…
npm install create-react-app -g

// ç”Ÿæˆå¼€å‘ç¯å¢ƒï¼Œlotteryä¸ºç›®å½•å
create-react-app lottery
```
å®‰è£…å®Œæˆåä¿®æ”¹æˆå¦‚ä¸‹å›¾ç›®å½•ç»“æ„
  
![](https://user-gold-cdn.xitu.io/2018/10/14/16672136c078fe2c?w=525&h=324&f=png&s=20740)

`turntable.jsx`å†…å®¹å¦‚ä¸‹ï¼š

```javascript
export default class Turntable {
}
```

`App.js`å†…å®¹å¦‚ä¸‹ï¼š

```javascript
import React, { Component } from 'react'
import Turntable from './turntable/turntable'
class App extends Component {
  constructor(props) {
    super(props)
  }
  render() {
    return <div>æŠ½å¥–è½¬ç›˜</div>
  }
}
export default App
```

å®Œæˆä»¥ä¸Šå·¥ä½œåï¼Œåœ¨å½“å‰ç›®å½•æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼Œè¾“å…¥`npm start`å¯åŠ¨é¡¹ç›®

#### 1.2.ç»˜åˆ¶å¤§è½¬ç›˜

ä¿®æ”¹`App.js`ä¸­çš„å†…å®¹å¦‚ä¸‹:

```javascript
import React, { Component } from 'react'
import Turntable from './turntable/turntable'
class App extends Component {
  constructor(props) {
    super(props)
    // reactä¸­è·å–domå…ƒç´ 
    this.canvas = React.createRef()
  }
  componentDidMount() {
    // canvaså…ƒç´ ä¿å­˜åœ¨this.canvasçš„currentå±æ€§ä¸­
    const canvas = this.canvas.current
    // è·å–canvasçš„ä¸Šä¸‹æ–‡,contextå«æœ‰å„ç§apiç”¨æ¥æ“ä½œcanvas
    const context = canvas.getContext('2d')
    // è®¾ç½®canvasçš„å®½é«˜
    canvas.width = 300
    canvas.height = 300
    // åˆ›å»ºturntableå¯¹è±¡,å¹¶å°†canvaså…ƒç´ å’Œcontextä¼ å…¥
    const turntable = new Turntable({canvas: canvas, context: context})
    turntable.render()
  }
  render() {
    return <canvas
      ref={this.canvas}
      style={{
        width: '300px',
        height: '300px',
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        margin: 'auto'
      }}>
    </canvas>
  }
}
export default App
```

ä¿®æ”¹`turntable.jsx`ä¸­çš„å†…å®¹:

```javascript
export default class Turntable {
  constructor(options) {
    // è·å–å¹¶ä¿å­˜ä¼ å…¥çš„canvas,context
    this.canvas = options.canvas
    this.context = options.context
  }
  drawPanel() {
    const context = this.context
    // ä¿å­˜å½“å‰ç”»å¸ƒçš„çŠ¶æ€,ä½¿ç”¨restoreè°ƒç”¨å,ä¿è¯äº†å½“å‰
    // ç»˜åˆ¶ä¸å—ä¹‹å‰ç»˜åˆ¶çš„å½±å“
    context.save()
    // æ–°å»ºä¸€ä¸ªè·¯å¾„,ç”»ç¬”çš„ä½ç½®å›åˆ°é»˜è®¤çš„åæ ‡(0,0)çš„ä½ç½®
    // ä¿è¯äº†å½“å‰çš„ç»˜åˆ¶ä¸ä¼šå½±å“åˆ°ä¹‹å‰çš„ç»˜åˆ¶
		context.beginPath()
    // è®¾ç½®å¡«å……è½¬ç›˜ç”¨çš„é¢œè‰²,fillæ˜¯å¡«å……è€Œä¸æ˜¯ç»˜åˆ¶.
    context.fillStyle = '#FD6961'
    // ç»˜åˆ¶ä¸€ä¸ªåœ†,æœ‰å…­ä¸ªå‚æ•°,åˆ†åˆ«è¡¨ç¤º:åœ†å¿ƒçš„xåæ ‡,åœ†å¿ƒçš„
    // yåæ ‡,åœ†çš„åŠå¾„,å¼€å§‹ç»˜åˆ¶çš„è§’åº¦,ç»“æŸçš„è§’åº¦,ç»˜åˆ¶æ–¹å‘
    // (falseè¡¨ç¤ºé¡ºæ—¶é’ˆ)
    context.arc(150, 150, 150, 0, Math.PI * 2, false)
    // å°†æˆ‘ä»¬è®¾ç½®çš„é¢œè‰²å¡«å……åˆ°åœ†ä¸­,è¿™é‡Œä¸ç”¨closePathæ˜¯å› 
    // ä¸ºclosePathå¯¹fillæ— æ•ˆ.
    context.fill()
    // å°†ç”»å¸ƒçš„çŠ¶æ€æ¢å¤åˆ°æˆ‘ä»¬ä¸Šä¸€æ¬¡save()æ—¶çš„çŠ¶æ€
    context.restore()
  } 
  render() {
		this.drawPanel()
	}
}
```

ä¿å­˜å,æµè§ˆå™¨ä¸­ç»“æœæ˜¾ç¤ºå¦‚ä¸‹å›¾:
  
![](https://user-gold-cdn.xitu.io/2018/10/14/16672f7ef2327125?w=887&h=451&f=png&s=14715)

#### 1.2.ç»˜åˆ¶å¥–å“å—

åœ¨`turntable.jsx`æ–‡ä»¶ä¸­çš„`Turntable`ç±»ä¸­æ·»åŠ å’Œä¿®æ”¹å†…å®¹å¦‚ä¸‹(ä¸ºäº†é¿å…é‡å¤å†…å®¹å¯¼è‡´ç¯‡å¹…è¿‡é•¿,æ‰€æœ‰ä¸å˜çš„éƒ¨åˆ†éƒ½ä¸ä¼šå±•ç¤º):

```javascript
// add
drawPrizeBlock() {
  const context = this.context
  // ç¬¬ä¸€ä¸ªå¥–å“è‰²å—å¼€å§‹ç»˜åˆ¶æ—¶å¼€å§‹çš„å¼§åº¦åŠç»“æŸçš„å¼§åº¦,å› ä¸ºæˆ‘ä»¬è¿™é‡Œ
  // æš‚æ—¶å›ºå®šè®¾ç½®ä¸º6ä¸ªå¥–å“,æ‰€ä»¥ä»¥6ä¸ºåŸºæ•°
  let startRadian = 0, RadianGap = Math.PI * 2 / 6, endRadian = startRadian + RadianGap
  for (let i = 0; i < 6; i++) {
    context.save()
    context.beginPath()
    // ä¸ºäº†åŒºåˆ†ä¸åŒçš„è‰²å—,æˆ‘ä»¬ä½¿ç”¨éšæœºç”Ÿæˆçš„é¢œè‰²ä½œä¸ºè‰²å—çš„å¡«å……è‰²
    context.fillStyle = '#'+Math.floor(Math.random()*16777215).toString(16)
    // è¿™é‡Œéœ€è¦ä½¿ç”¨moveToæ–¹æ³•å°†åˆå§‹ä½ç½®å®šä½åœ¨åœ†ç‚¹å¤„,è¿™æ ·ç»˜åˆ¶çš„åœ†
    // å¼§éƒ½ä¼šä»¥åœ†ç‚¹ä½œä¸ºé—­åˆç‚¹,ä¸‹é¢æœ‰ä½¿ç”¨moveToå’Œä¸ä½¿ç”¨moveToçš„å¯¹æ¯”å›¾
    context.moveTo(150, 150)
    // ç”»åœ†å¼§æ—¶,æ¯æ¬¡éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨moveTo,å°†ç”»ç¬”ç§»åŠ¨åˆ°åœ†å¼§çš„èµ·ç‚¹,åŠ
    // å¾„æˆ‘ä»¬è®¾ç½®çš„æ¯”è½¬ç›˜ç¨å°ä¸€ç‚¹
    context.arc(150, 150, 140, startRadian, endRadian, false)
    // æ¯ä¸ªå¥–å“è‰²å—ç»˜åˆ¶å®Œå,ä¸‹ä¸ªå¥–å“çš„å¼§åº¦ä¼šé€’å¢
    startRadian += RadianGap
    endRadian += RadianGap
    context.fill()
    context.restore()
  }
}
// modify
render() {
  this.drawPanel()
  this.drawPrizeBlock()
}
```

ä¿å­˜å,æˆ‘ä»¬çš„è½¬ç›˜å˜ä¸ºå¦‚ä¸‹å›¾æ ·å¼:
  
![](https://user-gold-cdn.xitu.io/2018/10/14/166730141b370137?w=887&h=451&f=png&s=24686)

ä½¿ç”¨ç»˜åˆ¶å¥–å“è‰²å—ä½¿ç”¨`context.moveTo(150, 150)`å’Œä¸ä½¿ç”¨çš„åŒºåˆ«:

ä½¿ç”¨äº†`context.moveTo(150, 150)`:
  
![](https://user-gold-cdn.xitu.io/2018/10/14/1667307ebb51d650?w=887&h=451&f=png&s=37248)

æ²¡æœ‰ä½¿ç”¨`context.moveTo(150, 150)`:
  
![](https://user-gold-cdn.xitu.io/2018/10/14/166730ae7602e398?w=887&h=451&f=png&s=36050)

å¥–å“å—ç»˜åˆ¶å¥½äº†,æˆ‘ä»¬éœ€è¦æ·»åŠ æ¯ä¸ªå¥–å“çš„åç§°,å‡å®šæˆ‘ä»¬æœ‰ä¸‰ä¸ªå¥–å“,å¦å¤–ä¸‰ä¸ªå°±è®¾ç½®ä¸ºæœªä¸­å¥–

`turntable.jsx`æ–‡ä»¶ä¸­å†…å®¹æ”¹å˜å¦‚ä¸‹:

```javascript
constructor(options) {
  this.canvas = options.canvas
  this.context = options.context
  // add åˆå§‹åŒ–æ—¶æ·»åŠ äº†å¥–å“çš„é…ç½®
  this.awards = [
    { level: 'ç‰¹ç­‰å¥–', name: 'æˆ‘çš„äº²ç¬”ç­¾å', color: '#576c0a' },
    { level: 'æœªä¸­å¥–', name: 'æœªä¸­å¥–', color: '#ad4411' },
    { level: 'ä¸€ç­‰å¥–', name: 'ç›èæ‹‰è’‚è¶…çº§ç»å…¸é™é‡è·‘è½¦', color: '#43ed04' },
    { level: 'æœªä¸­å¥–', name: 'æœªä¸­å¥–', color: '#d5ed1d' },
    { level: 'äºŒç­‰å¥–', name: 'è¾£æ¡ä¸€åŒ…', color: '#32acc6' },
    { level: 'æœªä¸­å¥–', name: 'æœªä¸­å¥–', color: '#e06510' },
  ]
}
// add
// æƒ³ä¸€æƒ³,å¦‚æˆ‘ä»¬ä¸€ç­‰å¥–é‚£æ ·,æ–‡å­—ç‰¹åˆ«é•¿çš„,è¶…å‡ºæˆ‘ä»¬çš„å¥–å“å—,è€Œcanvas
// å´ä¸æ˜¯é‚£ä¹ˆæ™ºèƒ½ç»™ä½ æä¾›è‡ªåŠ¨æ¢è¡Œçš„æœºåˆ¶,äºæ˜¯æˆ‘ä»¬åªæœ‰æ‰‹åŠ¨å¤„ç†æ¢è¡Œ
/**
 * 
 * @param {*} context         è¿™ä¸ªå°±ä¸ç”¨è§£é‡Šäº†~
 * @param {*} text            è¿™ä¸ªæ˜¯æˆ‘ä»¬éœ€è¦å¤„ç†çš„é•¿æ–‡æœ¬
 * @param {*} maxLineWidth    è¿™ä¸ªæ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ä¸€è¡Œæ–‡æœ¬æœ€å¤§çš„å®½åº¦
 */
// æ•´ä¸ªæ€è·¯å°±æ˜¯å°†æ»¡è¶³æˆ‘ä»¬å®šä¹‰çš„å®½åº¦çš„æ–‡æœ¬ä½œä¸ºvalueå•ç‹¬æ·»åŠ åˆ°æ•°ç»„ä¸­
// æœ€åè¿”å›çš„æ•°ç»„çš„æ¯ä¸€é¡¹å°±æ˜¯æˆ‘ä»¬å¤„ç†åçš„æ¯ä¸€è¡Œäº†.
getLineTextList(context, text, maxLineWidth) {
  let wordList = text.split(''), tempLine = '', lineList = []
  for (let i = 0; i < wordList.length; i++) {
    // measureTextæ–¹æ³•æ˜¯æµ‹é‡æ–‡æœ¬çš„å®½åº¦çš„,è¿™ä¸ªå®½åº¦ç›¸å½“äºæˆ‘ä»¬è®¾ç½®çš„
    // fontSizeçš„å¤§å°,æ‰€ä»¥åŸºäºè¿™ä¸ª,æˆ‘ä»¬å°†maxLineWidthè®¾ç½®ä¸ºå½“å‰å­—ä½“å¤§å°çš„å€æ•°
    if (context.measureText(tempLine).width >= maxLineWidth) {
      lineList.push(tempLine)
      maxLineWidth -= context.measureText(text[0]).width
      tempLine = ''
    }
    tempLine += wordList[i]
  }
  lineList.push(tempLine)
  return lineList
}
// modify 
drawPrizeBlock() {
  const context = this.context
  const awards = this.awards
  let startRadian = 0, RadianGap = Math.PI * 2 / 6, endRadian = startRadian + RadianGap
  for (let i = 0; i < awards.length; i++) {
    context.save()
    context.beginPath()
    context.fillStyle = awards[i].color
    context.moveTo(150, 150)
    context.arc(150, 150, 140, startRadian, endRadian, false)
    context.fill()
    context.restore()
    // å¼€å§‹ç»˜åˆ¶æˆ‘ä»¬çš„æ–‡å­—
    context.save();
    // è®¾ç½®æ–‡å­—é¢œè‰²
    context.fillStyle = '#FFFFFF';
    // è®¾ç½®æ–‡å­—æ ·å¼
    context.font = "14px Arial";
    // æ”¹å˜canvasåŸç‚¹çš„ä½ç½®,ç®€å•æ¥è¯´,translateåˆ°å“ªä¸ªåæ ‡ç‚¹,é‚£ä¹ˆé‚£ä¸ªåæ ‡ç‚¹å°±å°†å˜ä¸ºåæ ‡(0, 0)
    context.translate(
      150 + Math.cos(startRadian + RadianGap / 2) * 140,
      150 + Math.sin(startRadian + RadianGap / 2) * 140
    );
    // æ—‹è½¬è§’åº¦,è¿™ä¸ªæ—‹è½¬æ˜¯ç›¸å¯¹äºåŸç‚¹è¿›è¡Œæ—‹è½¬çš„.
    context.rotate(startRadian + RadianGap / 2 + Math.PI / 2);
    // è¿™é‡Œå°±æ˜¯æ ¹æ®æˆ‘ä»¬è·å–çš„å„è¡Œçš„æ–‡å­—è¿›è¡Œç»˜åˆ¶,maxLineWidthæˆ‘ä»¬å–70,ç›¸å½“ä¸
    // ä¸€è¡Œæˆ‘ä»¬æœ€å¤šå±•ç¤º5ä¸ªæ–‡å­—
    this.getLineTextList(context, awards[i].name, 70).forEach((line, index) => {
      // ç»˜åˆ¶æ–‡å­—çš„æ–¹æ³•,ä¸‰ä¸ªå‚æ•°åˆ†åˆ«å¸¦åˆ«:è¦ç»˜åˆ¶çš„æ–‡å­—,å¼€å§‹ç»˜åˆ¶çš„xåæ ‡,å¼€å§‹ç»˜åˆ¶çš„yåæ ‡
      context.fillText(line, -context.measureText(line).width / 2, ++index * 25);
    })
    context.restore();

    startRadian += RadianGap
    endRadian += RadianGap
  }
}
```

ä¿å­˜å,æˆ‘ä»¬è½¬ç›˜å˜æˆå¦‚ä¸‹æ¨¡æ ·:
  
![](https://user-gold-cdn.xitu.io/2018/10/15/16678457d6c11559?w=887&h=451&f=png&s=39973)